flowchart TD
  subgraph ExternalData[External Data Sources]
    S3[S3/Cloud Storage]
    Docs[Document Repos]
    DB[Databases]
    API[APIs]
  end

  subgraph DataPlane[Asynchronous Data Plane (Dagster)]
    Loader[Document Loader (LangChain)]
    Splitter[Text Splitter]
    Embed[Embedding Generation]
    Vector[Vector Store (FAISS/Pinecone/Milvus)]
    Lineage[Asset Lineage, Caching (Dagster)]
    Prefect[Control Plane (Prefect, optional)]
  end

  subgraph Handoff[Handoff Mechanism]
    Trigger[API/Sensor Trigger]
    BG[Blue/Green Deploy Validation (Prefect)]
  end

  subgraph ServingPlane[Synchronous Serving Plane (Ray Serve)]
    RayAPI[Ray Serve API Endpoint]
    Actor[Stateful Ray Actors]
    Agent[Agent Logic (LangChain/LangGraph)]
    Scale[Autoscaling, Batching]
  end

  subgraph Clients[Clients & Apps]
    Chat[Chatbot/Web/Mobile]
    Enterprise[Enterprise Apps/Integrations]
    Monitoring[Monitoring/Dashboards]
  end

  %% Data Flow
  S3 --> Loader
  Docs --> Loader
  DB --> Loader
  API --> Loader
  Loader --> Splitter
  Splitter --> Embed
  Embed --> Vector
  Vector --> Lineage
  Lineage --> Trigger
  Prefect --> Trigger
  Trigger --> BG
  BG --> RayAPI
  RayAPI --> Actor
  Actor --> Agent
  RayAPI --> Chat
  RayAPI --> Enterprise
  RayAPI --> Monitoring
  Scale -.-> RayAPI

  %% Feedback Loops
  Chat --> RayAPI
  Enterprise --> RayAPI
  Monitoring --> RayAPI