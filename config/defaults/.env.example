# =======================================
# .env.example - Updated Configuration Template
# =======================================
# Copy this file to .env and update values as needed
# This version supports both local development and Docker deployment

# =======================================
# Core Application Settings
# =======================================

DEBUG=true
LOG_LEVEL=INFO
ENVIRONMENT=development
SECRET_KEY=your-secret-key-here-change-in-production

# =======================================
# Service Ports
# =======================================

API_GATEWAY_PORT=8000
SEARCH_SERVICE_PORT=8001
EMBEDDING_SERVICE_PORT=8002
GENERATION_SERVICE_PORT=8003

# =======================================
# Database Configuration
# =======================================
# Services auto-detect localhost vs container networking

# PostgreSQL Configuration
POSTGRES_DB=chatbot_app
POSTGRES_USER=chatbot_user
POSTGRES_PASSWORD=your_postgres_password_here

# Redis Configuration
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# MongoDB Configuration
MONGO_DB=chatbot_app
MONGO_USER=root
MONGO_PASSWORD=your_mongo_password_here

# ScyllaDB Configuration
SCYLLA_KEYSPACE=chatbot_ks

# =======================================
# ML Model Configuration (Unified)
# =======================================

# Embedding Service
EMBEDDING_MODEL=sentence-transformers/all-MiniLM-L6-v2
EMBEDDING_DIMENSION=384

# Optional: Force specific configuration
# FORCE_DEVICE=cpu                    # Force CPU (overrides auto-detection)
# MAX_BATCH_SIZE=16                   # Override adaptive batch sizing
# MODEL_CACHE_DIR=/custom/path        # Override cache directory
# USE_MPS=false                       # Disable MPS even on M1 Macs

# Generation Service  
GENERATION_MODEL=microsoft/DialoGPT-medium
MAX_TOKENS=150
TEMPERATURE=0.7
TOP_P=0.9
TOP_K=50

# Optional: Force specific configuration
# TORCH_DTYPE=float32                 # Override adaptive dtype
# MAX_CONCURRENT_REQUESTS=2           # Override concurrency limits

# =======================================
# Search Configuration
# =======================================

# Vector Search Settings
DEFAULT_SEARCH_LIMIT=10
MAX_SEARCH_LIMIT=100
VECTOR_SIMILARITY_THRESHOLD=0.7

# Hybrid Search Weights
SEMANTIC_WEIGHT=0.7
KEYWORD_WEIGHT=0.3

# Database Connection Pool (adaptive)
# Local: DB_POOL_SIZE=10, DB_MAX_OVERFLOW=20
# Docker: DB_POOL_SIZE=5, DB_MAX_OVERFLOW=10

# =======================================
# Performance Settings
# =======================================

# Cache Settings
EMBEDDING_CACHE_TTL=86400          # 24 hours
SEARCH_CACHE_TTL=3600              # 1 hour
CACHE_COMPRESSION=true

# Rate Limiting (environment adaptive)
# AUTO: Local=1000/hour, Docker=500/hour
# MAX_REQUESTS_PER_HOUR=1000        # Override rate limiting

# Session Management
SESSION_TTL=7200                   # 2 hours
RATE_LIMIT_TTL=3600               # 1 hour

# =======================================
# Environment Detection Overrides
# =======================================
# Normally auto-detected, but can be forced

# CONTAINER=true                    # Force container mode
# IS_M1_MAC=true                   # Force M1 Mac optimizations

# =======================================
# Service URLs (Auto-Detected)
# =======================================
# Services automatically determine correct URLs:
# Local: http://localhost:PORT
# Docker: http://service-name:PORT
# Hybrid: http://localhost:PORT (for hybrid deployment)

# Override if needed:
# SEARCH_SERVICE_URL=http://localhost:8001
# EMBEDDING_SERVICE_URL=http://localhost:8002
# GENERATION_SERVICE_URL=http://localhost:8003

# =======================================
# Development Settings
# =======================================

# Auto-reload and debugging
AUTO_RELOAD=true
ENABLE_WARMUP=true
WARMUP_TIMEOUT=120

# Health Monitoring
ENABLE_HEALTH_MONITORING=true
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=15

# Performance Monitoring
ENABLE_PERFORMANCE_TRACKING=true
ENABLE_TELEMETRY=true
ENABLE_MEMORY_MONITORING=true
MEMORY_CLEANUP_THRESHOLD=0.80

# =======================================
# Document Processing Configuration
# =======================================

# Seeding Configuration
SEED_DOCS_PATH=./data/docs
SEED_CHUNK_CHARS=1500
SEED_CHUNK_OVERLAP=180
SEED_MAX_FILE_SIZE_MB=75
SEED_CREATE_ATLAS_INDEXES=1

# Document Processing Features
ENABLE_ADVANCED_DOC_PROCESSOR=1
SEED_ENABLE_PDF=1
SEED_ENABLE_DOCX=1
SEED_ENABLE_CSV=1

# Performance Settings (environment adaptive)
# Local: SEED_MAX_WORKERS=4, higher batch sizes
# Docker: SEED_MAX_WORKERS=2, conservative batch sizes

# =======================================
# RAG Pipeline Configuration
# =======================================

RAG_TOP_K=7
RAG_MAX_CONTEXT_CHARS=300
RAG_QUERY_TIMEOUT=2.5
RAG_DIVERSITY_THRESHOLD=0.80
RAG_ENABLED=true

# Hybrid Search
ENABLE_HYBRID_SEARCH=true
HYBRID_VECTOR_WEIGHT=0.8
HYBRID_TEXT_WEIGHT=0.2

# =======================================
# Vector Database Configuration
# =======================================

# MongoDB Vector Search
MONGO_EMBEDDING_DIM=384
MONGO_SIMILARITY_METRIC=cosine
MONGO_VECTOR_INDEX_NAME=vector_idx_embeddings_embedding
MONGO_KNOWLEDGE_VECTOR_INDEX_NAME=vector_idx_knowledge_vectors_embedding

# Atlas Search Settings
ENABLE_ATLAS_SEARCH=true
ATLAS_CLUSTER_NAME=mongodb-atlas-local
ATLAS_CANDIDATES_MULTIPLIER=12
ATLAS_MAX_CANDIDATES=2000

# Search Fallbacks
ENABLE_EXACT_SEARCH_FALLBACK=true
ENABLE_SEMANTIC_SEARCH_FALLBACK=true
MIN_EXACT_RESULTS=1
MIN_SEMANTIC_SCORE=0.25

# =======================================
# Security Configuration
# =======================================

# CORS Settings
CORS_ORIGINS=http://localhost:3000,http://localhost:8000,http://localhost:8080

# Authentication
ACCESS_TOKEN_EXPIRE_MINUTES=30

# =======================================
# Container-Specific Settings
# =======================================
# These are automatically applied in container environments

# Docker Optimizations (auto-applied in containers):
# - TORCH_NUM_THREADS=2
# - OMP_NUM_THREADS=2  
# - TOKENIZERS_PARALLELISM=false
# - Conservative memory settings
# - Pre-downloaded models
# - CPU-only device selection

# =======================================
# Local Development Optimizations
# =======================================
# These are automatically applied in local M1 Mac environments

# M1 Mac Optimizations (auto-applied on M1):
# - USE_MPS=true
# - Higher batch sizes
# - float16 precision
# - MPS device acceleration
# - Home directory cache paths
# - Higher performance settings

# PyTorch M1 Settings (export in shell if needed):
# export PYTORCH_ENABLE_MPS_FALLBACK=1
# export PYTORCH_MPS_HIGH_WATERMARK_RATIO=0.0

# =======================================
# Advanced Configuration
# =======================================

# Chatbot Behavior
RESPONSE_STRATEGY=rag_enhanced
FALLBACK_TO_TEMPLATE=true
CHATBOT_GENERATION_MAX_TOKENS=100
CHATBOT_GENERATION_TEMPERATURE=0.7

# Router Configuration
ROUTER_DEFAULT_MODE=auto

# Development Features
AUTO_SEED_ON_STARTUP=0